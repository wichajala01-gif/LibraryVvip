<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body {
            font-family: 'Mitr', sans-serif;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
            border-bottom-width: 4px;
            border-bottom-color: #a78bfa; /* Violet-400 */
        }
        .form-input {
            @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400;
        }
        .form-label {
            @apply block text-gray-700 text-sm font-bold mb-2;
        }
        .submit-button {
            @apply w-full bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform hover:scale-105 transition duration-300;
        }
        #qr-reader {
            border: 2px dashed #a78bfa;
            border-radius: 8px;
            overflow: hidden; /* Important for camera view styling */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-100 via-blue-100 to-purple-100 min-h-screen">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-green-500 via-blue-600 to-purple-700">
                üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ üìö
            </h1>
            <p class="text-gray-600 mt-2">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1 - 6</p>
        </header>

        <!-- Tabs Navigation -->
        <div class="mb-6 bg-white/70 backdrop-blur-sm rounded-xl shadow-md p-2 flex flex-wrap justify-center gap-2">
            <button class="tab-button active flex-grow md:flex-none px-6 py-3 rounded-lg font-semibold" onclick="showTab('borrow-return')">‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
            <button class="tab-button flex-grow md:flex-none px-6 py-3 rounded-lg font-semibold" onclick="showTab('check-in-out')">‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î</button>
            <button class="tab-button flex-grow md:flex-none px-6 py-3 rounded-lg font-semibold" onclick="showTab('add-book')">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</button>
            <button class="tab-button flex-grow md:flex-none px-6 py-3 rounded-lg font-semibold" onclick="showTab('assistant')">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå</button>
        </div>

        <!-- Tab Content -->
        <div id="tab-content" class="bg-white/80 backdrop-blur-md p-6 md:p-8 rounded-2xl shadow-xl">

            <!-- Borrow-Return Tab -->
            <div id="borrow-return" class="tab-panel">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
                <form id="borrow-return-form">
                    <input type="hidden" name="action" value="borrowReturn">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="form-label" for="br-student-id">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                            <input class="form-input" id="br-student-id" name="studentId" type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1234" required min="1" max="9999">
                        </div>
                        <div>
                            <label class="form-label" for="br-student-name">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                            <input class="form-input" id="br-student-name" name="studentName" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢‡πÉ‡∏à‡∏î‡∏µ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç" required>
                        </div>
                    </div>
                    
                    <div class="my-6 p-4 border-2 border-dashed border-purple-300 rounded-lg bg-purple-50">
                        <h3 class="text-lg font-semibold text-purple-800 mb-2 text-center">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h3>
                        <div id="scanner-container" class="my-4">
                            <!-- This div will contain the QR Code scanner video feed -->
                            <div id="qr-reader" class="w-full mx-auto" style="display: none;"></div>
                        </div>
                        <button type="button" id="start-scan-btn" class="w-full bg-purple-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-600 transition duration-300 mb-4">
                            üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
                        </button>
                         <p class="text-center text-sm text-gray-500">‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <label class="form-label" for="br-book-id">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label>
                            <input class="form-input" id="br-book-id" name="bookId" type="text" placeholder="‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" required>
                        </div>
                        <div>
                            <label class="form-label" for="br-book-title">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label>
                            <input class="form-input" id="br-book-title" name="bookTitle" type="text" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô" required>
                        </div>
                        <div>
                            <label class="form-label" for="br-author">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</label>
                            <input class="form-input" id="br-author" name="author" type="text" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô" required>
                        </div>
                        <div>
                             <label class="form-label" for="br-dewey">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏¥‡∏ß‡∏≠‡∏µ‡πâ</label>
                             <select id="br-dewey" name="dewey" class="form-input" required>
                                <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                                <option value="000">000 - ‡πÄ‡∏ö‡πá‡∏ï‡πÄ‡∏ï‡∏•‡πá‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                                <option value="100">100 - ‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤</option>
                                <option value="200">200 - ‡∏®‡∏≤‡∏™‡∏ô‡∏≤</option>
                                <option value="300">300 - ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                <option value="400">400 - ‡∏†‡∏≤‡∏©‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                <option value="500">500 - ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                <option value="600">600 - ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</option>
                                <option value="700">700 - ‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏≤‡∏£</option>
                                <option value="800">800 - ‡∏ß‡∏£‡∏£‡∏ì‡∏Ñ‡∏î‡∏µ</option>
                                <option value="900">900 - ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                             </select>
                        </div>
                         <div>
                            <label class="form-label" for="br-publisher">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå</label>
                            <input class="form-input" id="br-publisher" name="publisher" type="text" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô" required>
                        </div>
                         <div>
                            <label class="form-label" for="br-publish-year">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå</label>
                            <input class="form-input" id="br-publish-year" name="publishYear" type="number" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô" required>
                        </div>
                         <div class="md:col-span-2">
                            <label class="form-label" for="br-type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                            <select id="br-type" name="type" class="form-input" required>
                                <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
                                <option value="‡∏¢‡∏∑‡∏°">‡∏¢‡∏∑‡∏°</option>
                                <option value="‡∏Ñ‡∏∑‡∏ô">‡∏Ñ‡∏∑‡∏ô</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-8">
                        <button class="submit-button" type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</button>
                    </div>
                </form>
            </div>

            <!-- Check-in/out Tab -->
            <div id="check-in-out" class="tab-panel" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î</h2>
                <form id="check-in-out-form" class="max-w-md mx-auto">
                    <input type="hidden" name="action" value="checkInOut">
                     <div class="mb-4">
                        <label class="form-label" for="cio-student-id">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <input class="form-input" id="cio-student-id" name="studentId" type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1234" required min="1" max="9999">
                    </div>
                    <div class="mb-4">
                        <label class="form-label" for="cio-student-name">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <input class="form-input" id="cio-student-name" name="studentName" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏µ" required>
                    </div>
                    <div class="mb-6">
                        <label class="form-label" for="cio-type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                        <select id="cio-type" name="type" class="form-input" required>
                            <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                            <option value="‡πÄ‡∏Ç‡πâ‡∏≤">‡πÄ‡∏Ç‡πâ‡∏≤</option>
                            <option value="‡∏≠‡∏≠‡∏Å">‡∏≠‡∏≠‡∏Å</option>
                        </select>
                    </div>
                    <button class="submit-button" type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
                </form>
            </div>
            
            <!-- Add Book Tab -->
            <div id="add-book" class="tab-panel" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</h2>
                 <form id="add-book-form">
                    <input type="hidden" name="action" value="addBook">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="form-label" for="ab-book-title">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</label>
                            <input class="form-input" id="ab-book-title" name="bookTitle" type="text" required>
                        </div>
                        <div>
                            <label class="form-label" for="ab-author">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</label>
                            <input class="form-input" id="ab-author" name="author" type="text" required>
                        </div>
                        <div>
                             <label class="form-label" for="ab-dewey">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏î‡∏¥‡∏ß‡∏≠‡∏µ‡πâ</label>
                             <select id="ab-dewey" name="dewey" class="form-input" required>
                                <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                                <option value="000">000 - ‡πÄ‡∏ö‡πá‡∏ï‡πÄ‡∏ï‡∏•‡πá‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                                <option value="100">100 - ‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤</option>
                                <option value="200">200 - ‡∏®‡∏≤‡∏™‡∏ô‡∏≤</option>
                                <option value="300">300 - ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                <option value="400">400 - ‡∏†‡∏≤‡∏©‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                <option value="500">500 - ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                <option value="600">600 - ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</option>
                                <option value="700">700 - ‡∏®‡∏¥‡∏•‡∏õ‡∏∞‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏≤‡∏£</option>
                                <option value="800">800 - ‡∏ß‡∏£‡∏£‡∏ì‡∏Ñ‡∏î‡∏µ</option>
                                <option value="900">900 - ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                             </select>
                        </div>
                         <div>
                            <label class="form-label" for="ab-publisher">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå</label>
                            <input class="form-input" id="ab-publisher" name="publisher" type="text" required>
                        </div>
                         <div>
                            <label class="form-label" for="ab-publish-year">‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå</label>
                            <input class="form-input" id="ab-publish-year" name="publishYear" type="number" placeholder="‡∏û.‡∏®." required>
                        </div>
                         <div>
                            <label class="form-label" for="ab-book-id">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô)</label>
                            <input class="form-input" id="ab-book-id" name="bookId" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô B0001" required>
                        </div>
                    </div>
                    <div class="mt-8">
                        <button class="submit-button" type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </div>
                </form>
            </div>
            
            <!-- Assistant Tab -->
            <div id="assistant" class="tab-panel" style="display: none;">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå</h2>
                 <form id="assistant-form" class="max-w-md mx-auto">
                    <input type="hidden" name="action" value="assistantLog">
                     <div class="mb-4">
                        <label class="form-label" for="as-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå</label>
                        <input class="form-input" id="as-name" name="assistantName" type="text" required>
                    </div>
                    <div class="mb-6">
                        <label class="form-label" for="as-task">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥</label>
                        <select id="as-task" name="task" class="form-input" required>
                            <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥</option>
                            <option value="‡∏Å‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô">‡∏Å‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô</option>
                            <option value="‡∏ñ‡∏π‡∏û‡∏∑‡πâ‡∏ô">‡∏ñ‡∏π‡∏û‡∏∑‡πâ‡∏ô</option>
                            <option value="‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠">‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</option>
                            <option value="‡πÄ‡∏ä‡πá‡∏î‡πÇ‡∏ï‡πä‡∏∞">‡πÄ‡∏ä‡πá‡∏î‡πÇ‡∏ï‡πä‡∏∞</option>
                            <option value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</option>
                            <option value="‡πÄ‡∏ä‡πá‡∏î‡∏ä‡∏±‡πâ‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠">‡πÄ‡∏ä‡πá‡∏î‡∏ä‡∏±‡πâ‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</option>
                        </select>
                    </div>
                    <button class="submit-button" type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</button>
                </form>
            </div>
        </div>
    </div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwZzODVABJ4H5e6IcMkljn_djImg3hP6gVF9fNBknM2pFdX9a9w3ZsXezaFp6pFJvr3HA/exec";

    function showTab(tabId) {
        document.querySelectorAll('.tab-panel').forEach(panel => {
            panel.style.display = 'none';
        });
        document.getElementById(tabId).style.display = 'block';

        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('active');
        });
        document.querySelector(`button[onclick="showTab('${tabId}')"]`).classList.add('active');
    }

    function handleFormSubmit(event) {
        event.preventDefault();
        const form = event.target;
        
        Swal.fire({
            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        const formData = new FormData(form);
        let url = SCRIPT_URL + "?callback=handleResponse";
        formData.forEach((value, key) => {
            url += `&${encodeURIComponent(key)}=${encodeURIComponent(value)}`;
        });
        
        const timestamp = new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' });
        url += `&timestamp=${encodeURIComponent(timestamp)}`;

        const script = document.createElement('script');
        script.src = url;
        document.body.appendChild(script);
        
        script.onload = () => document.body.removeChild(script);
        script.onerror = () => {
             document.body.removeChild(script);
             Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ', 'error');
        };
    }
    
    window.handleResponse = function(response) {
        if (response.status === 'success') {
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', response.message, 'success');
            const activeFormId = document.querySelector('.tab-panel[style*="block"]').querySelector('form').id;
            document.getElementById(activeFormId).reset();
        } else {
            Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', response.message, 'error');
        }
    }
    
    document.getElementById('borrow-return-form').addEventListener('submit', handleFormSubmit);
    document.getElementById('check-in-out-form').addEventListener('submit', handleFormSubmit);
    document.getElementById('add-book-form').addEventListener('submit', handleFormSubmit);
    document.getElementById('assistant-form').addEventListener('submit', handleFormSubmit);

    // --- NEW AND IMPROVED QR Code Scanner Logic ---
    let html5QrCode = null;

    function stopScanner() {
        if (html5QrCode && html5QrCode.isScanning) {
            html5QrCode.stop().then(() => {
                console.log("QR Code scanning stopped.");
                document.getElementById('qr-reader').style.display = 'none';
                document.getElementById('start-scan-btn').textContent = 'üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠';
            }).catch(err => {
                console.error("Failed to stop QR Code scanning.", err);
            });
        }
    }

    function onScanSuccess(decodedText, decodedResult) {
        console.log(`Scan result: ${decodedText}`);
        stopScanner();
        Swal.fire({
            title: '‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
            text: `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™: ${decodedText}`,
            icon: 'info',
            showConfirmButton: false,
            timer: 1500
        });
        fetchBookData(decodedText);
    }

    function onScanFailure(error) {
        // This function can be verbose. It's useful for debugging but not for users.
        // console.warn(`Code scan error = ${error}`);
    }

    function fetchBookData(bookId) {
         Swal.fire({
            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', allowOutsideClick: false,
            didOpen: () => { Swal.showLoading(); }
        });
        const url = `${SCRIPT_URL}?callback=handleBookDataResponse&action=getBookData&bookId=${encodeURIComponent(bookId)}`;
        const script = document.createElement('script');
        script.src = url;
        document.body.appendChild(script);
        script.onload = () => document.body.removeChild(script);
        script.onerror = () => {
             document.body.removeChild(script);
             Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÑ‡∏î‡πâ', 'error');
        };
    }
    
    window.handleBookDataResponse = function(response) {
        if(response.status === 'success' && response.data) {
            const data = response.data;
            document.getElementById('br-book-id').value = data.bookId || '';
            document.getElementById('br-book-title').value = data.bookTitle || '';
            document.getElementById('br-author').value = data.author || '';
            document.getElementById('br-dewey').value = data.dewey || '';
            document.getElementById('br-publisher').value = data.publisher || '';
            document.getElementById('br-publish-year').value = data.publishYear || '';
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        } else {
             Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™ "${response.bookId}" ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`, 'warning');
        }
    }

    document.getElementById('start-scan-btn').addEventListener('click', () => {
        if (!html5QrCode) {
            html5QrCode = new Html5Qrcode("qr-reader");
        }

        if (html5QrCode.isScanning) {
            stopScanner();
        } else {
            const qrReaderElement = document.getElementById('qr-reader');
            qrReaderElement.style.display = 'block';
            document.getElementById('start-scan-btn').textContent = '‚èπÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á...';

            const config = { fps: 10, qrbox: { width: 250, height: 250 } };

            // Find the back camera
            Html5Qrcode.getCameras().then(cameras => {
                if (cameras && cameras.length) {
                    let cameraId = cameras.find(camera => camera.label.toLowerCase().includes('back'))?.id;
                    if (!cameraId) {
                        cameraId = cameras[cameras.length - 1].id; // Fallback to the last camera
                    }
                    
                    document.getElementById('start-scan-btn').textContent = '‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô';
                    html5QrCode.start(
                        cameraId, 
                        config, 
                        onScanSuccess, 
                        onScanFailure
                    ).catch(err => {
                        console.error("Error starting scanner:", err);
                        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á', 'error');
                        stopScanner();
                    });
                } else {
                     Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì', 'error');
                     document.getElementById('start-scan-btn').textContent = 'üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠';
                }
            }).catch(err => {
                console.error("Error getting cameras:", err);
                Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'error');
                document.getElementById('start-scan-btn').textContent = 'üì∑ ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠';
                qrReaderElement.style.display = 'none';
            });
        }
    });
    
    showTab('borrow-return');
</script>

</body>
</html>

